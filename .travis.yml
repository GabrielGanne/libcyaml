language: c
sudo: required
matrix:
  include:
    - compiler: gcc
      script:
        - make test
        - make valgrind-quiet
    - compiler: clang
      script:
        - make test
        - make valgrind-quiet
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - python-pip
      env:
        - BUILD_TYPE=Coverage
      script:
        - make test
        - |
          sudo pip install gcovr;
          make coverage;
          find build/coverage -name "*.gc*" -type f -delete;
          bash <(curl -s https://codecov.io/bash) -X search -f build/coverage.xml;
    - env:
        global:
        - secure: "YP0IhYE2MuA21lb6pGMRy1FMVH0ttSN8uEWGEHu4uqQuXapUQ3kJncLk9f3sxTClnJVeDLBoBt6oYjzvJV20dG+0D7hwG4UUDTDKKiwkTCvOKU5a6UqrSHicAgTOacQ51TxWwC6DKbsa8iSgCRmOoZr8X8fG0TmxLWWC9b0z4gDCdIc1ccWbDSMaByS39yBJ/ooYt04beEhHXVWRVjUWEwaYW53Abm98zDXsv4kslcFFINhB0tSiufpEqmprq2m0oNBaEY1YooW56fWDZg+yxalX67/SIAgYeH0FS106tyhaQP+GSMi7HgKUhrPCba9m7GECsWK0W1pq0GzsCokX6HKwBfylHYXguVetQPHgwMmN0rckSEuB5cKf/y4/n5deXEkyUPsZ50lImyNegFdG44yFhlsPg1GQam2IMucDY+7S/8uR9poEeFIhwBqIx+xE+cq+Mg+ejD5+ugY9ij2SUqs7YsW4SUIa2IkA1igQ3o+nHkYZz9SUYokRFWyeCcXO9CfABzdMj5SCp7souCd+q48UTd4lk7ae3wOlMi6gQ/nj8dZvUqfnWpbSylAuzPn+Xklh3GJsYSKsU30dsjG3vLhahqZNwShG51UeTe1elfGpXXOk0UEJfOKfpOXjvgK0zK616BeyawqxxueaB01Xo7GwZMKjWg+Wz7zw9FqAwC0="
      before_install:
        - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
      addons:
        coverity_scan:
          project:
            name: "tlsa/libcyaml"
            description: "C library for reading and writing YAML."
          notification_email: tlsa@netsurf-browser.org
          build_command_prepend: "make clean"
          build_command: "make"
          branch_pattern: tlsa/coverity-scan

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y valgrind libyaml-dev
